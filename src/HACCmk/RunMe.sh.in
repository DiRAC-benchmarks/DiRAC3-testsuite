#!/bin/bash -x

export BG_SHAREDMEMSIZE=${HACCMK_BG_SHAREDMEMSIZE}
export L1P_POLICY=${HACCMK_L1P_POLICY}
export PROG=$<TARGET_FILE:HACCmk>
export NODES=${HACCMK_NODES}
export RANKS_PER_NODE=${HACCMK_RANKS_PER_NODE}
export OMP_NUM_THREADS=${HACCMK_OMP_NUM_THREADS}
export BG_THREADLAYOUT=${HACCMK_BG_THREADLAYOUT}   # 1 - default next core first; 2 - my core first
export NPROCS=${HACCMK_NPROCS} 
export OUTPUT=${HACCMK_JOBNAME}
export VARS=${HACCMK_VARS}

rm -f ${DIRAC3_TESTSUITE_OUTPUTS_PATH}/core.* ${DIRAC3_TESTSUITE_OUTPUTS_PATH}/${HACCMK_JOBNAME}.cobaltlog ${DIRAC3_TESTSUITE_OUTPUTS_PATH}/${HACCMK_JOBNAME}.error ${DIRAC3_TESTSUITE_OUTPUTS_PATH}/${HACCMK_JOBNAME}.output

qsub -A Performance -n ${HACCMK_NODES} --proccount ${HACCMK_RANKS_PER_NODE} --mode c${HACCMK_RANKS_PER_NODE} -t 0:10:00 -O ${HACCMK_JOBNAME} --env ${HACCMK_VARS} $<TARGET_FILE:HACCmk>
