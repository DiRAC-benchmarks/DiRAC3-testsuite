#!/usr/bin/env bash
pushd ${DIRAC3_TESTSUITE_RUN_PATH}

export OMP_NUM_THREADS=${HOST_CPUS_PER_NODE}
GRID_FLAGS="--decomposition --threads $OMP_NUM_THREADS --mpi ${GRID_MPI_LAYOUT}"

${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_comms $GRID_FLAGS 1> ${DIRAC3_JOB_OUTFILE} 2> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_dwf_sweep $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_memory_asynch $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_memory_bandwidth $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_su3 $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_wilson_sweep $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/Benchmark_zmm $GRID_FLAGS 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}

popd
