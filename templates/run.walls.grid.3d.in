#!/usr/bin/env bash
pushd ${DIRAC3_TESTSUITE_RUN_PATH}
ln -s ${WALLS_INPUT_FILE}

OMP_NUM_THREADS=${HOST_CPUS_PER_NODE}
echo "Walls Benchmark" > ${DIRAC3_JOB_OUTFILE}
echo "Walls Benchmark" > ${DIRAC3_JOB_ERRFILE}
for dd in 16 32 64 128 256 512 1024
do
  d2=$(($dd * 2))
  ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/walls_xeon_mpi_3d -g $dd.$dd.$dd -m ${WALLS_MPI_LAYOUT} 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
  ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/walls_xeon_mpi_3d -g $d2.$dd.$dd -m ${WALLS_MPI_LAYOUT} 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
  ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${DIRAC3_JOB_NODES} ${MPIEXEC_PREFLAGS} ${EXECUTABLE_OUTPUT_PATH}/walls_xeon_mpi_3d -g $d2.$d2.$dd -m ${WALLS_MPI_LAYOUT} 1>> ${DIRAC3_JOB_OUTFILE} 2>> ${DIRAC3_JOB_ERRFILE}
done

popd
